@model DAL.Entities.ProjectReferences
@{
    ViewBag.Title = "EditProjectReference";
    Layout = "~/Areas/Admin/Views/Shared/adminlayout.cshtml";
}

<style>
.MultiFile-label {margin-top: 10px;}

</style>
<link href="~/Areas/Admin/Content/styles/pluginstyles/jquery.msgbox.css" rel="stylesheet" />
<link href="~/Areas/Admin/Content/styles/forms.css" rel="stylesheet" />
<link href="~/Areas/Admin/Content/styles/table.css" rel="stylesheet" />
<script src="~/Areas/Admin/Content/scripts/plugins/jquery.MultiFile.js"></script>
<script src="~/Content/Scripts/jquery.koalazoom.packed.js"></script>
@Html.Partial("ProjectReference_leftbar")

<div id="page-content" class="container_12">
    <div id="page-header">
        <h2>REFERANS BİLGİLERİ</h2>
    </div>
    @if (TempData["ImageSizeError"] != null)
    {
        <div class="notification error">@TempData["ImageSizeError"].ToString()</div>
    }
    <section class="grid_12 form">
        @Html.Hidden("ProcessMessage", (object)@ViewBag.ProcessMessage)
        @using (Html.BeginForm("EditProjectReference", "ProjectReference", FormMethod.Post, new { enctype = "multipart/form-data" }))
        {
            @Html.Hidden("hdfieldcategory")
            @Html.Hidden("hdfieldtaglist")
            @Html.ValidationSummary(true)
            <fieldset>
                <legend>Referans Düzenle</legend>
                <p>
                    @Html.LabelFor(m => m.Language)
                    @Html.DropDownListFor(m => m.Language, (IEnumerable<SelectListItem>)ViewBag.LanguageList, "Dil Seçiniz...")
                    @Html.ValidationMessageFor(m => m.Language)
                </p>
                <p>
                    @Html.Label("Referans Grubu")
                    @Html.DropDownListFor(m => m.ProjectReferenceGroupId, (IEnumerable<SelectListItem>)ViewBag.grouplist, "Referans Grubunu Seçiniz...", new { @class = "required" })
                    @Html.ValidationMessageFor(m => m.ProjectReferenceGroupId)
                    <img src="/Areas/Admin/Content/images/icons/16/loader.gif" id="imgloader" class="imgloader" />
                </p>
                <p>
                    @Html.Label("Referans Adı")
                    @Html.TextBoxFor(m => m.Name, new { @class = "textwidth50" })
                    @Html.ValidationMessageFor(m => m.Name)
                </p>
                <p>
                    @Html.Label("Alt Başlık")
                    @Html.TextBoxFor(m => m.SubTitle, new { @class = "textwidth50", @row = "3" })
                    @Html.ValidationMessageFor(m => m.SubTitle)
                </p>
                <p>
                    <label>Devam Eden Proje mi?</label>
                    @Html.CheckBoxFor(m => m.Devam)
                </p>
                @* <p>
            <label>Logo</label>
            
            <input type="file" name="uploadimage" id="uploadimage" />
        </p>*@
                <p>
                    <label>Referans Dosyası</label>

                    <input type="file" name="uploadimage" id="uploadfile" />
                </p>

                <p style="float: left; margin-right: 4px !important;">
                    <label>Referans Fotoğrafları</label>
                </p>
                <div style="width: 249px; width: 25%; float: left">
                    <input type="file" style="width: 99%" name="attachments" class="multi" />
                </div>
                <div style="height: 40px; clear: both;"></div>
                <fieldset>
                    <legend>Referans Fotoğrafları</legend>
                    @{Html.RenderAction("Photos", "ProjectReference", new { categoryId = 1, itemId = Model.ProjectReferenceId });}
                </fieldset>
                <fieldset>
                    <legend>Ana Resim</legend>
                    <div id="uploadPartial">
                        @Html.Partial("_imageUploadAndCrop")
                    </div>
                </fieldset>
                <p>
                    @Html.Label("Referans Açıklaması")
                    @Html.TextAreaFor(m => m.Content, 5, 0, new { id = "txtcontent", @class = "textwidth50" })
                    @Html.ValidationMessageFor(m => m.Content, "", new { @class = "verticalaligntop" })

                </p>
                <p>
                    <input type="submit" value="Kaydet" id="btnsave" />
                </p>

            </fieldset>
        }
    </section>
</div>
@section Scripts {
    <link href="~/Areas/Admin/Content/styles/pluginstyles/jquery.msgbox.css" rel="stylesheet" />
    <script src="~/Areas/Admin/Content/scripts/plugins/jquery.msgbox.min.js"></script>
    <script src="~/Areas/Admin/Content/scripts/myscripts/MessageBox.js"></script>
    <script src="~/Areas/Admin/Content/scripts/plugins/jquery.validate.js"></script>
    <script src="~/Areas/Admin/Content/scripts/plugins/jquery.validate.unobtrusive.js"></script>
    <script src="~/Areas/Admin/Content/scripts/plugins/jquery.ui.datepicker-tr.js"></script>
    <script src="~/Areas/Admin/Content/scripts/pagescripts/ProjectReferences/editProjectReference.js"></script>

    <script src="~/Areas/Admin/Content/CKEditor/ckeditor/ckeditor.js"></script>
    <script src="~/Areas/Admin/Content/CKEditor/ckfinder/ckfinder.js"></script>
    <script src="~/Areas/Admin/Content/scripts/myscripts/CKEditorCreate.js"></script>
}
<script>
    function rg_click_handler() {
        var newpath = $("#imgNewImage").attr('src');
        var photoId = $("#currenPhotoId").val();

        newpath = "/Content/images/userfiles/" + newpath.split('=')[1] + "." + photoId.split('.')[1];
        if (newpath == "") {
            alert("Lütfen resim kırpma işlemini yapınız...");
            return false;
        }
        $("#btnResimGuncelle").css("display", "none");

        $.ajax({
            type: 'POST',
            url: '@Url.Action("UpdatePhotoPath", "Project")',
            data: "{'photoId':'" + photoId.split('.')[0] + "', 'newpath':'" + newpath + "'}",
            contentType: "application/json; charset=utf-8",
            dataType: 'json',
            success: function (result) {
                $('#uploadPartial').load('@Url.Action("imageUploadAndCrop", "Media")');

                $.gritter.add({
                    title: 'Resim güncelleme!',
                    text: 'Resim kırpma işlemi başarı ile gerçekleştirilmiştir...'
                });
            },
            error: function () {

            }
        });
        }
        $("#btnResimGuncelle").bind("click", rg_click_handler);
</script>

